---
id: preference-optimize
title: "Run preference optimization of a model."
description: "Run preference optimization of a model."
sidebar_label: "Run preference optimization of a model."
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/llama-stack-specification
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Run preference optimization of a model."}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/v1/post-training/preference-optimize"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Run preference optimization of a model.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={[]}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"job_uuid":{"type":"string","description":"The UUID of the job to create."},"finetuned_model":{"type":"string","description":"The model to fine-tune."},"algorithm_config":{"description":"The algorithm configuration.","type":"object","properties":{"beta":{"type":"number","description":"Temperature parameter for the DPO loss"},"loss_type":{"default":"sigmoid","description":"The type of loss function to use for DPO","type":"string","enum":["sigmoid","hinge","ipo","kto_pair"],"title":"DPOLossType"}},"additionalProperties":false,"required":["beta","loss_type"],"title":"DPOAlignmentConfig"},"training_config":{"description":"The training configuration.","type":"object","properties":{"n_epochs":{"type":"integer","description":"Number of training epochs to run"},"max_steps_per_epoch":{"type":"integer","default":1,"description":"Maximum number of steps to run per epoch"},"gradient_accumulation_steps":{"type":"integer","default":1,"description":"Number of steps to accumulate gradients before updating"},"max_validation_steps":{"type":"integer","default":1,"description":"(Optional) Maximum number of validation steps per epoch"},"data_config":{"description":"(Optional) Configuration for data loading and formatting","type":"object","properties":{"dataset_id":{"type":"string","description":"Unique identifier for the training dataset"},"batch_size":{"type":"integer","description":"Number of samples per training batch"},"shuffle":{"type":"boolean","description":"Whether to shuffle the dataset during training"},"data_format":{"description":"Format of the dataset (instruct or dialog)","type":"string","enum":["instruct","dialog"],"title":"DatasetFormat"},"validation_dataset_id":{"type":"string","description":"(Optional) Unique identifier for the validation dataset"},"packed":{"type":"boolean","default":false,"description":"(Optional) Whether to pack multiple samples into a single sequence for efficiency"},"train_on_input":{"type":"boolean","default":false,"description":"(Optional) Whether to compute loss on input tokens as well as output tokens"}},"additionalProperties":false,"required":["dataset_id","batch_size","shuffle","data_format"],"title":"DataConfig"},"optimizer_config":{"description":"(Optional) Configuration for the optimization algorithm","type":"object","properties":{"optimizer_type":{"description":"Type of optimizer to use (adam, adamw, or sgd)","type":"string","enum":["adam","adamw","sgd"],"title":"OptimizerType"},"lr":{"type":"number","description":"Learning rate for the optimizer"},"weight_decay":{"type":"number","description":"Weight decay coefficient for regularization"},"num_warmup_steps":{"type":"integer","description":"Number of steps for learning rate warmup"}},"additionalProperties":false,"required":["optimizer_type","lr","weight_decay","num_warmup_steps"],"title":"OptimizerConfig"},"efficiency_config":{"description":"(Optional) Configuration for memory and compute optimizations","type":"object","properties":{"enable_activation_checkpointing":{"type":"boolean","default":false,"description":"(Optional) Whether to use activation checkpointing to reduce memory usage"},"enable_activation_offloading":{"type":"boolean","default":false,"description":"(Optional) Whether to offload activations to CPU to save GPU memory"},"memory_efficient_fsdp_wrap":{"type":"boolean","default":false,"description":"(Optional) Whether to use memory-efficient FSDP wrapping"},"fsdp_cpu_offload":{"type":"boolean","default":false,"description":"(Optional) Whether to offload FSDP parameters to CPU"}},"additionalProperties":false,"title":"EfficiencyConfig"},"dtype":{"type":"string","default":"bf16","description":"(Optional) Data type for model parameters (bf16, fp16, fp32)"}},"additionalProperties":false,"required":["n_epochs","max_steps_per_epoch","gradient_accumulation_steps"],"title":"TrainingConfig"},"hyperparam_search_config":{"type":"object","additionalProperties":{"oneOf":[{"type":"null"},{"type":"boolean"},{"type":"number"},{"type":"string"},{"type":"array"},{"type":"object"}]},"description":"The hyperparam search configuration."},"logger_config":{"type":"object","additionalProperties":{"oneOf":[{"type":"null"},{"type":"boolean"},{"type":"number"},{"type":"string"},{"type":"array"},{"type":"object"}]},"description":"The logger configuration."}},"additionalProperties":false,"required":["job_uuid","finetuned_model","algorithm_config","training_config","hyperparam_search_config","logger_config"],"title":"PreferenceOptimizeRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"A PostTrainingJob.","content":{"application/json":{"schema":{"type":"object","properties":{"job_uuid":{"type":"string"}},"additionalProperties":false,"required":["job_uuid"],"title":"PostTrainingJob"}}}},"400":{"description":"The request was invalid or malformed","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":400,"title":"Bad Request","detail":"The request was invalid or malformed"}}}},"429":{"description":"The client has sent too many requests in a given amount of time","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":429,"title":"Too Many Requests","detail":"You have exceeded the rate limit. Please try again later."}}}},"500":{"description":"The server encountered an unexpected error","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":500,"title":"Internal Server Error","detail":"An unexpected error occurred. Our team has been notified."}}}},"default":{"description":"An unexpected error occurred","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":0,"title":"Error","detail":"An unexpected error occurred"}}}}}}
>
  
</StatusCodes>


      